<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        /* å…ƒã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å®Œå…¨ã«ç¶­æŒ */
        html, body { 
            position: fixed; width: 100%; height: 100%; 
            overflow: hidden; touch-action: none; 
            font-family: sans-serif; margin: 0; background: #f0f4f8; 
        }
        #app { display: flex; flex-direction: column; height: 100%; }
        header { height: 70px; background: #fff; text-align: center; border-bottom: 2px solid #dee2e6; display: flex; flex-direction: column; justify-content: center; }
        #main-stage { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; }
        #drop-zone { width: 150px; height: 150px; border: 4px dashed #adb5bd; border-radius: 50%; display: flex; align-items: center; justify-content: center; background: #fff; position: relative; color: #adb5bd; font-weight: bold; }
        #item-box { height: 120px; display: flex; align-items: center; justify-content: center; width: 100%; }
        .active-item { width: 68px; height: 68px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 32px; color: #fff; cursor: pointer; user-select: none; touch-action: none; z-index: 100; }
        .bg-blue { background: #007bff; }
        .bg-green { background: #28a745; }
        .bg-orange { background: #fd7e14; }
        .bg-red { background: #dc3545; }
        .input-card { background: #fff; padding: 10px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-top: 5px; width: 80%; }
        input[type="number"] { width: 50px; padding: 5px; border: 1px solid #ccc; border-radius: 4px; font-size: 16px; }
        .status-dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-right: 5px; background: #ccc; }
        #next-btn { display: none; margin-top: 15px; padding: 10px 25px; font-size: 18px; border-radius: 8px; background: #007bff; color: white; border: none; }
    </style>
</head>
<body>

<div id="app">
    <header>
        <h2 id="q-title" style="margin:0; font-size: 18px;"></h2>
        <div id="step-info" style="font-size: 12px; color: #666;"></div>
    </header>
    <div id="main-stage">
        <div id="drop-zone">ã‚³ã‚³ã«é‹ã‚“ã§</div>
        <div id="item-box"></div>
        
        <div id="q3-inputs" style="display:none; width: 100%; display: flex; flex-direction: column; align-items: center;">
            <div id="input-grip" class="input-card">
                <div class="status-dot" id="dot-grip"></div>æ¡åŠ›: <input type="number" id="grip" step="0.1" oninput="judgeGrip()"> (kg)
            </div>
            <div id="input-bmi" class="input-card">
                <div class="status-dot" id="dot-bmi"></div>
                èº«é•·: <input type="number" id="height" step="0.1" oninput="calcBMI()">
                ä½“é‡: <input type="number" id="weight" step="0.1" oninput="calcBMI()">
                <div style="margin-top:5px;">BMI: <span id="bmi-val">--</span></div>
            </div>
        </div>

        <button id="next-btn" onclick="goNext()">æ¬¡ã¸é€²ã‚€</button>
    </div>
</div>

<script>
    let currentIdx = 0;
    let allAnswers = {}; // 15å•å¯¾å¿œã®ãƒã‚±ãƒ„

    const questions = [
        { id: "q1", title: "åœ°åŸŸæ´»å‹•ã«å‚åŠ ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ", item: "ğŸ ", color: "bg-blue" },
        { id: "q2", title: "æœ€è¿‘ã€æ­©ãã®ãŒé…ããªã£ãŸï¼Ÿ", item: "ğŸš¶", color: "bg-green" },
        { id: "q3", title: "æ¡åŠ›ã¨BMIã‚’æ¸¬å®šã—ã‚ˆã†", item: "âš–ï¸", color: "bg-orange" }
    ];

    function load() {
        const q = questions[currentIdx];
        document.getElementById('q-title').innerText = q.title;
        document.getElementById('step-info').innerText = `Step ${currentIdx + 1} / ${questions.length}`;
        
        // ã‚¢ã‚¤ã‚³ãƒ³ã®å¾©æ´»
        const itemBox = document.getElementById('item-box');
        itemBox.innerHTML = `<div class="active-item ${q.color}" id="active-item" ontouchstart="onStart(event)" onmousedown="onStart(event)">${q.item}</div>`;
        
        // ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ã®åˆæœŸåŒ–
        const dz = document.getElementById('drop-zone');
        dz.innerHTML = "ã‚³ã‚³ã«é‹ã‚“ã§";
        
        // å…¥åŠ›ã‚¨ãƒªã‚¢ã®è¡¨ç¤ºåˆ¶å¾¡
        document.getElementById('q3-inputs').style.display = (q.id === "q3") ? "block" : "none";
        document.getElementById('next-btn').style.display = "none";
    }

    function goNext() {
        const q = questions[currentIdx];
        
        // ãƒ‡ãƒ¼ã‚¿ã®è‡ªå‹•å›å
        if (q.id === "q3") {
            allAnswers.grip = document.getElementById('grip').value;
            allAnswers.height = document.getElementById('height').value;
            allAnswers.weight = document.getElementById('weight').value;
            allAnswers.bmi = document.getElementById('bmi-val').innerText;
        }
        
        // ãƒ‰ãƒ­ãƒƒãƒ—åˆ¤å®šã®çµæœã‚’ä¿å­˜
        const isDropped = document.getElementById('drop-zone').querySelector('.active-item');
        allAnswers[q.id] = isDropped ? "ã¯ã„" : "ã„ã„ãˆ";

        currentIdx++;
        if (currentIdx < questions.length) {
            load();
        } else {
            // æœ€çµ‚é€ä¿¡
            const url = new URL(window.location.href);
            Object.keys(allAnswers).forEach(key => url.searchParams.set(key, allAnswers[key]));
            window.location.href = url.href; 
        }
    }

    // ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ï¼ˆå…ƒã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ç¶­æŒï¼‰
    let active, isDragging = false;
    function onStart(e) {
        isDragging = true; active = e.target;
        active.style.position = "absolute";
        const t = e.touches ? e.touches[0] : e;
        updatePos(t