<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        /* スタイルはあなたの元のコードを継承しているわ */
        html, body { position: fixed; width: 100%; height: 100%; overflow: hidden; touch-action: none; font-family: sans-serif; margin: 0; background: #f0f4f8; }
        #app { display: flex; flex-direction: column; height: 100%; }
        header { height: 60px; background: #fff; text-align: center; border-bottom: 2px solid #dee2e6; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        #main-stage { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; }
        .drop-zone { width: 120px; height: 120px; border: 3px dashed #ccc; border-radius: 50%; display: flex; align-items: center; justify-content: center; background: #fff; }
        .drag-item { width: 80px; height: 80px; background: #007bff; color: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; position: absolute; cursor: pointer; z-index: 10; }
        .controls { padding: 20px; background: #fff; border-top: 1px solid #ddd; }
        input { width: 60px; padding: 5px; font-size: 16px; }
    </style>
</head>
<body>
<div id="app">
    <header id="q-text">読み込み中...</header>
    <div id="main-stage">
        <div class="drop-zone" id="drop-zone">ここにドロップ</div>
        <div class="drag-item" id="drag-item">YES</div>
    </div>
    <div class="controls">
        握力: <input type="number" id="grip" value="30"> kg
        BMI: <span id="bmi-val">--</span>
        <button onclick="goNext()" style="float:right; padding:10px 20px; background:#28a745; color:white; border:none; border-radius:5px;">次へ</button>
    </div>
</div>

<script>
    // 簡易的な設問データ
    const questions = ["半年で2-3kg体重が減った？", "歩くのが遅くなった？", "握力が落ちた？"];
    let currentIdx = 0;

    function load() {
        document.getElementById('q-text').innerText = questions[currentIdx];
    }

    function goNext() {
        currentIdx++;
        if (currentIdx < questions.length) {
            load();
        } else {
            // すべての質問が終わったら、親（Streamlit）にデータを渡してリロード
            const grip = document.getElementById('grip').value;
            const bmi = "22.0"; // ここは計算ロジックを入れてね
            
            // 親ウィンドウ（Streamlit）のURLに結果を付与してリダイレクト
            const finalUrl = window.parent.location.origin + window.parent.location.pathname + 
                             "?grip=" + grip + "&bmi=" + bmi;
            window.parent.location.href = finalUrl;
        }
    }

    // ドラッグ＆ドロップの簡易実装（スマホ対応）
    const item = document.getElementById('drag-item');
    item.addEventListener('touchmove', function(e) {
        const touch = e.touches[0];
        item.style.left = (touch.clientX - 40) + 'px';
        item.style.top = (touch.clientY - 40) + 'px';
    });

    load();
</script>
</body>
</html>