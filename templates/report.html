<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>詳細レポート</title>
    <style>
        body { font-family: sans-serif; background: #f0f4f8; padding: 20px; color: #333; }
        .card { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); max-width: 600px; margin: auto; }
        h2 { text-align: center; color: #28a745; margin-bottom: 20px; }
        .info-section { border-bottom: 2px solid #eee; padding-bottom: 15px; margin-bottom: 20px; font-size: 0.9rem; line-height: 1.6; }
        .table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .table th, .table td { padding: 12px; border-bottom: 1px solid #eee; text-align: left; }
        .table th { width: 40%; color: #666; font-size: 0.85rem; }
        .table td { font-weight: bold; }
        
        /* 判定ラベルのスタイル */
        .status-badge { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; color: white; margin-left: 10px; }
        .bg-blue { background-color: #007bff; }
        .bg-red { background-color: #dc3545; }
        .bg-yellow { background-color: #ffc107; color: #333; }
        .bg-white { background-color: #fff; border: 1px solid #ccc; color: #333; }
        .bg-gray { background-color: #adb5bd; }

        .btn-group { display: flex; gap: 10px; margin-top: 30px; }
        .btn { flex: 1; text-align: center; padding: 15px; border-radius: 12px; text-decoration: none; font-weight: bold; }
        .btn-main { background: #007bff; color: white; }
        .btn-sub { background: #6c757d; color: white; }
        @media print { .btn-group { display: none; } }
    </style>
</head>
<body>
    <div class="card">
        <h2>フレイル測定 詳細レポート</h2>
        
        <div class="info-section">
            <p><strong>測定日時:</strong> {{ date }}</p>
            <p><strong>お名前:</strong> {{ user.name }} 様</p>
            <p><strong>身体状況:</strong> {{ '男性' if user.gender == '1' else '女性' }} / BMI: {{ answers.bmi }} / 握力: {{ answers.grip }}kg</p>
        </div>

        <table class="table">
            <thead>
                <tr>
                    <th>項目</th>
                    <th>回答</th>
                    <th>判定</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>指輪っかテスト</td>
                    <td>{{ answers.finger }}</td>
                    <td><span class="status-badge bg-{{ colors.finger }}">{{ '注意' if colors.finger == 'red' else '良好' }}</span></td>
                </tr>
                <tr>
                    <td>BMI（体格）</td>
                    <td>{{ answers.bmi }}</td>
                    <td><span class="status-badge bg-{{ colors.bmi }}">{{ '注意' if colors.bmi == 'red' else '良好' }}</span></td>
                </tr>
                <tr>
                    <td>握力</td>
                    <td>{{ answers.grip }}kg</td>
                    <td><span class="status-badge bg-{{ colors.grip }}">{{ '注意' if colors.grip == 'red' else '良好' }}</span></td>
                </tr>

                {% set q_labels = {
                    'q1': '健康状態', 'q2': '生活満足度', 'q3': '3食食べている', 'q4': '噛む力', 'q5': 'むせやすさ',
                    'q6': '体重の変化', 'q7': '歩く速さ', 'q8': '転倒の経験', 'q9': '運動の習慣', 'q10': '物忘れ',
                    'q11': '日付の認識', 'q12': 'たばこの習慣', 'q13': '外出の頻度', 'q14': '友人との交流', 'q15': '相談できる人'
                } %}

                {% for i in range(1, 16) %}
                {% set qid = "q" ~ i %}
                <tr>
                    <td>Q{{ i }} {{ q_labels[qid] }}</td>
                    <td>{{ answers[qid] }}</td>
                    <td>
                        {% if colors[qid] == 'red' %}
                            <span class="status-badge bg-red">要確認</span>
                        {% elif colors[qid] == 'yellow' %}
                            <span class="status-badge bg-yellow">注意</span>
                        {% elif colors[qid] == 'white' or colors[qid] == 'blue' %}
                            <span class="status-badge bg-blue">良好</span>
                        {% else %}
                            <span class="status-badge bg-gray">-</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div class="btn-group">
            <a href="/mypage" class="btn btn-sub">マイページ</a>
            <a href="javascript:window.print()" class="btn btn-main">レポートを印刷・保存</a>
        </div>
    </div>
</body>
</html>